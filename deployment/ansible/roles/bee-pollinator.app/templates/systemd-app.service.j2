[Unit]
Description=icp-app
After=network.target

[Service]
PermissionsStartOnly=true
PIDFile=/run/icp-app/icp-app.pid
User=icp
Group=icp
WorkingDirectory={{ app_home }}
ExecStartPre=/bin/mkdir /run/icp-app
ExecStartPre=/bin/chown -R icp:icp /run/icp-app
ExecStart=/usr/bin/envdir /etc/icp.d/env /usr/local/bin/gunicorn --pid /run/icp-app/icp-app.pid --config /etc/icp.d/gunicorn.py icp.wsgi
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s TERM $MAINPID
ExecStopPost=/bin/rm -rf /run/icp-app
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=gunicorn

[Install]
{% if ['development', 'test'] | some_are_in(group_names) -%}
WantedBy=opt-app.mount
{% else %}
WantedBy=multi-user.target
{% endif %}
